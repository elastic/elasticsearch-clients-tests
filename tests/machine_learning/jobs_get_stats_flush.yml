---
setup:
  - do:
      ml.put_job:
        job_id: jobs-stats-flush
        body:  >
          {
            "job_id":"jobs-stats-flush",
            "description":"Analysis of response time by airline",
            "analysis_config" : {
                "bucket_span": "1h",
                "detectors" :[{"function":"metric","field_name":"responsetime","by_field_name":"airline"}]
            },
            "analysis_limits" : {
                "model_memory_limit": "10mb"
            },
            "data_description" : {
                "format":"xcontent",
                "time_field":"time",
                "time_format":"epoch"
            }
          }

---
teardown:
  - do:
      ml.delete_job: { job_id: jobs-stats-flush }
---
"Test get job stats after uploading data prompting the creation of some stats":
  - do:
      ml.open_job:
        job_id: jobs-stats-flush
  - do:
      ml.flush_job:
        job_id: jobs-stats-flush
  - match: { flushed: true }

  - do:
      ml.get_job_stats:
        job_id: jobs-stats-flush
  - match:  { jobs.0.job_id : jobs-stats-flush }
  - match:  { jobs.0.state: opened }
  - do:
      ml.close_job:
        job_id: jobs-stats-flush
