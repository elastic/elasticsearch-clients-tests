---
requires:
  serverless: true
  stack: true
---
teardown:
  - do:
      indices.delete:
        index: connectors-test
        ignore: 404
---
"Connector":
  - do:
      connector.put:
        connector_id: test-connector-1
        body:
          index_name: connectors-test
  - match: { result: 'created' }

  - do:
      connector.check_in:
        connector_id: test-connector-1
  - match: { result: updated }

  - do:
      connector.last_sync:
        connector_id: test-connector-1
        body:
          last_sync_error: "oh no error"
          last_access_control_sync_scheduled_at: "2023-05-25T12:30:00.000Z"
  - match: { result: updated }

  - do:
      connector.get:
        connector_id: test-connector-1
  - match: { index_name: connectors-test }
  - match: { last_sync_error: "oh no error" }
  - match: { last_access_control_sync_scheduled_at: "2023-05-25T12:30:00.000Z" }

  - do:
      connector.list: {}
  - gte: { count: 1 }

  - do:
      connector.post: { }
  - set:  { id: id }
  - match: { id: $id }

  - do:
      connector.get:
        connector_id: $id
  - match: { id: $id }

  - do:
      connector.delete:
        connector_id: test-connector-1
  - match: { acknowledged: true }
